# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# UNAUTHORITY (LOS) - VALIDATOR CONFIGURATION v1.0
# Sentry Node Architecture: Public Shield + Private Validator Separation
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[validator]
# Validator Node ID (immutable)
node_id = "validator-1"

# Wallet Address (from Genesis Bootstrap)
# ⚠️ CRITICAL: Set via environment variable LOS_VALIDATOR_ADDRESS per node
# Each validator MUST have unique address from genesis_config.json bootstrap_nodes array
# Validator-1 → bootstrap_nodes[0]
# Validator-2 → bootstrap_nodes[1]
# Validator-3 → bootstrap_nodes[2]
# Validator-4 → bootstrap_nodes[3]
address = "${LOS_VALIDATOR_ADDRESS:-LOSX7dStdPkS9U4MFCmDQfpmvrbMa5WAZfQX1}"

# Private Key Path (stored securely in cold storage)
# ⚠️ CRITICAL: Never commit this file with actual private key to git!
# Use environment variables instead: export LOS_VALIDATOR_PRIVKEY_PATH=/path/to/key
private_key_path = "${LOS_VALIDATOR_PRIVKEY_PATH}"

# Initial Stake (minimum 1000 LOS = 100,000,000,000,000 CIL)
stake_cil = 100000000000000  # 1000 LOS

# Enable automatic reward claiming
auto_claim_rewards = true

# Slashing penalties (%)
double_signing_slash = 100      # 100% loss + ban
downtime_slash = 1              # 1% loss per epoch

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SENTRY NODE ARCHITECTURE
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[sentry_public]
# Public facing address (internet-accessible, exposed to P2P network)
listen_addr = "0.0.0.0"
# ⚠️ Set per validator via LOS_SENTRY_PORT env var
# Validator-1 → 30333
# Validator-2 → 30334
# Validator-3 → 30335
# Validator-4 → 30336
listen_port = ${LOS_SENTRY_PORT:-30333}

# Public .onion address that peers use to connect (Tor-only network)
# Set via LOS_ONION_ADDRESS env var or auto-generated by Tor Control Port
external_addr = "${LOS_ONION_ADDRESS:-auto}"
external_port = ${LOS_SENTRY_PORT:-30333}

# Maximum connections from external peers
max_inbound_connections = 64
max_outbound_connections = 32

# DDoS protection settings
connection_timeout_seconds = 30
rate_limit_requests_per_second = 100
ban_duration_minutes = 10

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PRIVATE SIGNER CONNECTION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[signer_private]
# Private connection to Signer Node (NOT exposed to internet)
# Typically runs on localhost or private VPN/Wireguard network
listen_addr = "127.0.0.1"
# ⚠️ Set per validator via LOS_SIGNER_PORT env var
# Validator-1 → 30331
# Validator-2 → 30332
# Validator-3 → 30333
# Validator-4 → 30334
listen_port = ${LOS_SIGNER_PORT:-30331}

# Must be VPN/encrypted tunnel (Noise Protocol Framework)
encryption_enabled = true
encryption_type = "noise_protocol"

# Signer node connection (internal, not public)
# Use private IP, localhost, or Wireguard IP
signer_endpoint = "127.0.0.1:${LOS_SIGNER_PORT:-30331}"

# Authentication: both nodes must share pre-shared key
psk_file_path = "/etc/los-validator/signer.psk"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# NETWORK CONFIGURATION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[network]
# Bootstrap nodes — REFERENCE ONLY (not parsed by los-node).
# Rust P2P uses LOS_BOOTSTRAP_NODES env var. Flutter apps use assets/network_config.json.
# Current active testnet .onion addresses (generated by setup_tor_testnet.sh):
bootstrap_peers = [
  "onion://drnqiaqi5vvqpubem6qzptptijygbf7ggjheri6k5yn4qbeezhgjweyd.onion:3030",
  "onion://kpjv64bpekzqvnls2d5ss4sqhjdgi7maypfvceekxty2cfutjr4vgqid.onion:3031",
  "onion://w3x7wqb7267mfgcxsqjuinxuijvdswg4j2zwcdl2fr5mohbaywomdbad.onion:3032",
  "onion://xvulzhd5ekfmturmz7jdy3yguggyqwyx7jrysods7njvvzaicx72lwad.onion:3033"
]

# P2P Protocol settings
protocol_version = "1.0"
p2p_encryption = "noise_protocol"

# Connection pool settings
max_peers = 128
min_peers = 8
peer_discovery_interval_seconds = 300

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# BLOCK PRODUCTION & CONSENSUS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[consensus]
# Consensus algorithm (Asynchronous Byzantine Fault Tolerance)
type = "aBFT"

# Block finality parameters
finality_blocks = 1
finality_time_seconds = 3
target_block_time_seconds = 3

# Byzantine threshold (1/3 + 1 nodes)
byzantine_tolerance = 0.33

# Vote parameters
min_votes_required_percentage = 67
vote_timeout_seconds = 5

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# GAS & TRANSACTION FEES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[gas]
# Base gas price (in CIL - smallest unit)
base_price_cil = 1000

# Maximum gas per transaction
max_gas_per_tx = 10000000

# Gas used per byte of transaction data
gas_per_byte = 10

# Fee scaling for spam prevention (flat fee by default)
dynamic_scaling_enabled = true

# When single address sends >10 tx/sec, multiply gas by 2^n
spam_threshold_tx_per_sec = 10
spam_scaling_factor = 2

# Burn limit per block (prevents burn abuse per block)
burn_limit_per_block_cil = 1000000000

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# DATABASE & STORAGE
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[storage]
# Data directory for blocks and state
data_dir = "./node_data/validator-1"

# Database type
db_backend = "rocksdb"

# Pruning: Keep only recent blocks
prune_blocks_older_than_days = 90
prune_enabled = true

# Snapshot settings
enable_snapshots = true
snapshot_interval_blocks = 10000

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# LOGGING & MONITORING
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[logging]
# Log level: TRACE, DEBUG, INFO, WARN, ERROR
level = "INFO"

# Log format
format = "json"  # or "plain"

# Log file paths
log_dir = "./logs"
log_file = "validator.log"
log_max_size_mb = 100
log_max_backups = 10

# Metrics collection
metrics_enabled = true
metrics_port = 9090
metrics_path = "/metrics"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SECURITY BEST PRACTICES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# 1. PRIVATE KEY SECURITY:
#    - NEVER commit private key to Git
#    - Use environment variable: export LOS_VALIDATOR_PRIVKEY_PATH=/path/to/key
#    - Store key in cold storage / HSM (Hardware Security Module)
#    - Restrict file permissions: chmod 600
#
# 2. SENTRY NODE ISOLATION:
#    - Public sentry should run on DMZ or separate machine
#    - Private signer should NOT be internet-facing
#    - Use Wireguard/VPN tunnel between sentry and signer
#    - Use Noise Protocol Framework for all P2P encryption
#
# 3. PRE-SHARED KEY (PSK):
#    - Generate: openssl rand -hex 32 > /etc/los-validator/signer.psk
#    - Share securely with signer node
#    - Rotate periodically
#    - Restrict permissions: chmod 600
#
# 4. FIREWALL:
#    - Port 30333 (sentry public): Allow from 0.0.0.0/0 (rate-limited)
#    - Port 30334 (signer private): Allow ONLY from sentry node IP
#    - All other ports: DENY
#
# 5. MONITORING:
#    - Monitor for double-signing attempts (automatic ban)
#    - Monitor uptime (>95% required, or face 1% slash per epoch)
#    - Alert on stake changes or unusual activity
#    - Keep private key access logs
#
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
